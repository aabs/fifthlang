<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        <link rel="canonical" href="https://fifth-lang.org/Designs/perf/baselines/">
        <link rel="shortcut icon" href="../../../img/favicon.ico">
        <title>Baselines - The Fifth Programming Language</title>
        <link href="../../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../../css/fontawesome.min.css" rel="stylesheet">
        <link href="../../../css/brands.min.css" rel="stylesheet">
        <link href="../../../css/solid.min.css" rel="stylesheet">
        <link href="../../../css/v4-font-face.min.css" rel="stylesheet">
        <link href="../../../css/base.css" rel="stylesheet">
        <link id="hljs-light" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" >
        <link id="hljs-dark" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css" disabled>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../../..">The Fifth Programming Language</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar-collapse" aria-controls="navbar-collapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="nav-item">
                                <a href="../../.." class="nav-link">Fifth Language</a>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Blog</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../../Blog/2025-09-16-graph-assertion-block/" class="dropdown-item">Announcing Graph Assertion Blocks in Fifth</a>
</li>
                                    
<li>
    <a href="../../../Blog/2025-11-28-release-packaging-pipeline/" class="dropdown-item">A Practical Release Pipeline for Fifth</a>
</li>
                                </ul>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle active" aria-current="page" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Designs</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../5thproj-implementation-summary/" class="dropdown-item">.5thproj MSBuild Project Type Implementation Summary</a>
</li>
                                    
<li>
    <a href="../../fifth-sdk-readme/" class="dropdown-item">Fifth.Sdk</a>
</li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Misc</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../misc/AST_REWRITER_DESIGN/" class="dropdown-item">AST Rewriter Design</a>
</li>
            
<li>
    <a href="../../misc/debugging/" class="dropdown-item">Debugging Workflows</a>
</li>
            
<li>
    <a href="../../misc/destructuring-lowering-migration/" class="dropdown-item">Destructuring Lowering Migration to Statement-Hoisting Rewriter</a>
</li>
            
<li>
    <a href="../../misc/generics-implementation-summary/" class="dropdown-item">Generic Type Support Implementation Summary</a>
</li>
            
<li>
    <a href="../../misc/migration-exception-handling/" class="dropdown-item">Migration Notes - Exception Handling Support</a>
</li>
            
<li>
    <a href="../../misc/namespace-import-directives-research/" class="dropdown-item">Research Notes: Namespace Import Directives</a>
</li>
            
<li>
    <a href="../../misc/syntax-samples-readme/" class="dropdown-item">Syntax Samples</a>
</li>
            
<li>
    <a href="../../misc/syntax-testcases-bulleted/" class="dropdown-item">Fifth Syntax Unit Tests (Bulleted)</a>
</li>
            
<li>
    <a href="../../misc/syntax-testplan/" class="dropdown-item">Fifth Language Syntax Test Plan</a>
</li>
            
<li>
    <a href="../../misc/triple-diagnostics-refactor/" class="dropdown-item">Deferred Triple Diagnostics Refactor</a>
</li>
            
<li>
    <a href="../../misc/vscode-devkit-tests/" class="dropdown-item">VS Code Dev Kit: Running xUnit Tests</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Perf</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="./" class="dropdown-item active" aria-current="page">Baselines</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Development</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../../Development/release-process/" class="dropdown-item">Fifth Language Release Process</a>
</li>
                                </ul>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Getting Started</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../../Getting-Started/knowledge-graphs/" class="dropdown-item">Knowledge Graphs in Fifth</a>
</li>
                                    
<li>
    <a href="../../../Getting-Started/learn5thInYMinutes/" class="dropdown-item">learn5thInYMinutes</a>
</li>
                                </ul>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Planning</a>
                                <ul class="dropdown-menu">
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Architecture review</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../Planning/architecture-review/NEXT-STEPS/" class="dropdown-item">Architectural Review - Next Steps</a>
</li>
            
<li>
    <a href="../../../Planning/architecture-review/architectural-review-2025/" class="dropdown-item">Fifth Language Compiler - Architectural Review Report</a>
</li>
            
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Arch review issues</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../../../Planning/architecture-review/arch-review-issues/" class="dropdown-item">Architectural Review Issues</a>
</li>
            
<li>
    <a href="../../../Planning/architecture-review/arch-review-issues/ISSUE-001-error-recovery/" class="dropdown-item">Parser Needs Error Recovery for IDE Support</a>
</li>
            
<li>
    <a href="../../../Planning/architecture-review/arch-review-issues/ISSUE-002-lsp-implementation/" class="dropdown-item">Implement Language Server Protocol (LSP) for IDE Integration</a>
</li>
            
<li>
    <a href="../../../Planning/architecture-review/arch-review-issues/ISSUE-003-incremental-compilation/" class="dropdown-item">Implement Incremental Compilation for Performance and IDE Support</a>
</li>
            
<li>
    <a href="../../../Planning/architecture-review/arch-review-issues/ISSUE-004-diagnostic-system/" class="dropdown-item">Redesign Diagnostic System for Quality Error Messages and IDE Support</a>
</li>
            
<li>
    <a href="../../../Planning/architecture-review/arch-review-issues/ISSUE-005-composable-pipeline/" class="dropdown-item">Refactor Transformation Pipeline to Composable Architecture</a>
</li>
            
<li>
    <a href="../../../Planning/architecture-review/arch-review-issues/ISSUE-006-symbol-table/" class="dropdown-item">Enhance Symbol Table for Performance and IDE Features</a>
</li>
            
<li>
    <a href="../../../Planning/architecture-review/arch-review-issues/ISSUE-007-testing-architecture/" class="dropdown-item">Restructure Testing Architecture for Better Coverage and Maintainability</a>
</li>
    </ul>
  </li>
    </ul>
  </li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ms-md-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-bs-toggle="modal" data-bs-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../../misc/vscode-devkit-tests/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../../../Development/release-process/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-bs-toggle="collapse" data-bs-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-body-tertiary">
        <ul class="nav flex-column">
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<p>Per-runner Baselines for Guard Validation</p>
<p>Overview</p>
<p>This repository stores canonical guard-validation benchmark baselines in a per-runner-family fashion.
Each baseline is a JSON file containing a mapping of benchmark names to median timings (in nanoseconds) and a small metadata block describing the environment where the baseline was produced.</p>
<p>Baseline file locations</p>
<ul>
<li>Generic baseline (fallback):</li>
<li>test/perf/baselines/guard_validation_baseline.json</li>
<li>Per-runner-family baselines (preferred for strict comparisons):</li>
<li>test/perf/baselines/guard_validation_baseline.<family>.json</li>
</ul>
<p>Where <family> is a short, sanitized string describing the runner family, derived from OS/distro and CPU model, e.g.:</p>
<p>ubuntu24-epyc-7763
  macos-m1</p>
<p>Family naming rules</p>
<ul>
<li>
<p>The family string is computed in the Benchmarks workflow by combining the OS major version and a short architecture token (e.g. amd64 or arm64). Examples:</p>
</li>
<li>
<p>Ubuntu 24.04 on x86_64 -&gt; "linux24-amd64"</p>
</li>
<li>
<p>macOS 14 on arm64 -&gt; "macos14-arm64"</p>
</li>
<li>
<p>This naming is intentionally stable: it avoids encoding exact CPU microarchitecture names (which vary a lot) and instead focuses on OS major version + architecture so baselines are more reusable and less noisy.</p>
</li>
</ul>
<p>Why per-runner baselines?</p>
<p>Micro-benchmarks are sensitive to hardware, CPU topology, OS version, and underlying virtualization. Comparing numbers across different runner families (for example, local dev Mac vs GitHub-hosted Ubuntu EPYC) leads to false regressions. Using per-runner baselines reduces noise and increases signal when evaluating perf regressions.</p>
<p>Workflow behavior (how baselines are promoted)</p>
<ul>
<li>The Benchmarks GitHub Action runs on a runner and computes a family string for that runner.</li>
<li>The compare step attempts to use a per-family baseline file (guard_validation_baseline.<family>.json). If that file exists it will be used.</li>
<li>If the per-family baseline does not exist, the workflow falls back to the generic baseline (guard_validation_baseline.json) if present.</li>
<li>To propose a new baseline for the current runner family, run the Benchmarks workflow with the workflow_dispatch input <code>updateBaseline=true</code>.</li>
<li>The job will generate guard_validation_current_baseline.<family>.json and open an automated PR that replaces/creates test/perf/baselines/guard_validation_baseline.<family>.json with the current results.</li>
<li>A human reviewer should inspect the PR (and the baseline metadata) before merging.</li>
</ul>
<p>Policy for running strict perf assertions</p>
<ul>
<li>Strict perf assertions (the <code>perf-assertions</code> project) require a family-specific baseline in order to run on GitHub-hosted runners. The policy is conservative because hosted runners may change over time and we prefer to avoid flaky CI failures.</li>
<li>If a family baseline exists, perf assertions run normally.</li>
<li>If no family baseline exists:</li>
<li>If updateBaseline=true, the workflow writes the current baseline and opens a PR for promotion.</li>
<li>Otherwise, the workflow will skip running the strict perf assertions on hosted runners (to avoid noisy failures). The workflow will still generate artifacts and a compare summary.</li>
<li>Self-hosted runners (or controlled perf runners) are allowed to run strict perf assertions even if no family baseline exists. If you want to run assertions on a self-hosted runner with no baseline, create or adjust the appropriate family baseline or set the <code>updateBaseline</code> flag to produce a candidate baseline PR.</li>
</ul>
<p>Inspecting and reviewing baseline PRs</p>
<ul>
<li>Baseline PRs contain the new baseline JSON file and the metadata (OS, CPU, dotnet version, commit) that produced the baseline. Reviewers should ensure the environment is the intended one (for example, an authorized perf runner) and that the numbers look reasonable before merging.</li>
</ul>
<p>Notes</p>
<ul>
<li>If you want to adopt a stricter or looser policy (for example, auto-merge baselines created on a protected runner or require multiple runs before promoting), ask and we can update the workflow to implement that policy (for example, add protected-branch rules, a reviewer requirement, or a second-run verification).</li>
</ul>
<p>Interim note: CI enforcement of the macrobench "no measurable regression" gate is deferred; run the macrobench locally before pushing and include results in your PR description.</p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../../../js/bootstrap.bundle.min.js"></script>
        <script>
            var base_url = "../../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../../js/base.js"></script>
        <script src="../../../search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
