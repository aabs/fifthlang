<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://fifth-lang.org/Designs/perf/baselines/" />
      <link rel="shortcut icon" href="../../../img/favicon.ico" />
    <title>Baselines - The Fifth Programming Language</title>
    <link rel="stylesheet" href="../../../css/theme.css" />
    <link rel="stylesheet" href="../../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Baselines";
        var mkdocs_page_input_path = "Designs\\perf\\baselines.md";
        var mkdocs_page_url = "/Designs/perf/baselines/";
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../../.." class="icon icon-home"> The Fifth Programming Language
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../..">Fifth Language</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Blog</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../Blog/2025-09-16-graph-assertion-block/">Announcing Graph Assertion Blocks in Fifth</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../Blog/2025-11-16%20Announcing%20Fifth%20Lang/">Announcing Fifth - A New Language For Knowledge Graphs</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../Blog/2025-11-28-release-packaging-pipeline/">A New Release Pipeline for Fifth</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Designs</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../../5thproj-implementation-summary/">.5thproj MSBuild Project Type Implementation Summary</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../fifth-sdk-readme/">Fifth.Sdk</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Misc</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../misc/AST_REWRITER_DESIGN/">AST Rewriter Design</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../misc/debugging/">Debugging Workflows</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../misc/destructuring-lowering-migration/">Destructuring Lowering Migration to Statement-Hoisting Rewriter</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../misc/generics-implementation-summary/">Generic Type Support Implementation Summary</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../misc/migration-exception-handling/">Migration Notes - Exception Handling Support</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../misc/namespace-import-directives-research/">Research Notes: Namespace Import Directives</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../misc/syntax-samples-readme/">Syntax Samples</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../misc/syntax-testcases-bulleted/">Fifth Syntax Unit Tests (Bulleted)</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../misc/syntax-testplan/">Fifth Language Syntax Test Plan</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../misc/triple-diagnostics-refactor/">Deferred Triple Diagnostics Refactor</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../misc/vscode-devkit-tests/">VS Code Dev Kit: Running xUnit Tests</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" >Perf</a>
    <ul class="current">
                <li class="toctree-l2 current"><a class="reference internal current" href="#">Baselines</a>
                </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Development</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../Development/release-process/">Fifth Language Release Process</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Getting Started</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../Getting-Started/knowledge-graphs/">Knowledge Graphs in Fifth</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../Getting-Started/learn5thInYMinutes/">learn5thInYMinutes</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Planning</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" >Architecture review</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../../Planning/architecture-review/NEXT-STEPS/">Architectural Review - Next Steps</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../Planning/architecture-review/architectural-review-2025/">Fifth Language Compiler - Architectural Review Report</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" >Arch review issues</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../../Planning/architecture-review/arch-review-issues/">Architectural Review Issues</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../../Planning/architecture-review/arch-review-issues/ISSUE-001-error-recovery/">Parser Needs Error Recovery for IDE Support</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../../Planning/architecture-review/arch-review-issues/ISSUE-002-lsp-implementation/">Implement Language Server Protocol (LSP) for IDE Integration</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../../Planning/architecture-review/arch-review-issues/ISSUE-003-incremental-compilation/">Implement Incremental Compilation for Performance and IDE Support</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../../Planning/architecture-review/arch-review-issues/ISSUE-004-diagnostic-system/">Redesign Diagnostic System for Quality Error Messages and IDE Support</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../../Planning/architecture-review/arch-review-issues/ISSUE-005-composable-pipeline/">Refactor Transformation Pipeline to Composable Architecture</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../../Planning/architecture-review/arch-review-issues/ISSUE-006-symbol-table/">Enhance Symbol Table for Performance and IDE Features</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../../Planning/architecture-review/arch-review-issues/ISSUE-007-testing-architecture/">Restructure Testing Architecture for Better Coverage and Maintainability</a>
                </li>
    </ul>
                </li>
    </ul>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../..">The Fifth Programming Language</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../.." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Designs</li>
          <li class="breadcrumb-item">Perf</li>
      <li class="breadcrumb-item active">Baselines</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <p>Per-runner Baselines for Guard Validation</p>
<p>Overview</p>
<p>This repository stores canonical guard-validation benchmark baselines in a per-runner-family fashion.
Each baseline is a JSON file containing a mapping of benchmark names to median timings (in nanoseconds) and a small metadata block describing the environment where the baseline was produced.</p>
<p>Baseline file locations</p>
<ul>
<li>Generic baseline (fallback):</li>
<li>test/perf/baselines/guard_validation_baseline.json</li>
<li>Per-runner-family baselines (preferred for strict comparisons):</li>
<li>test/perf/baselines/guard_validation_baseline.<family>.json</li>
</ul>
<p>Where <family> is a short, sanitized string describing the runner family, derived from OS/distro and CPU model, e.g.:</p>
<p>ubuntu24-epyc-7763
  macos-m1</p>
<p>Family naming rules</p>
<ul>
<li>
<p>The family string is computed in the Benchmarks workflow by combining the OS major version and a short architecture token (e.g. amd64 or arm64). Examples:</p>
</li>
<li>
<p>Ubuntu 24.04 on x86_64 -&gt; "linux24-amd64"</p>
</li>
<li>
<p>macOS 14 on arm64 -&gt; "macos14-arm64"</p>
</li>
<li>
<p>This naming is intentionally stable: it avoids encoding exact CPU microarchitecture names (which vary a lot) and instead focuses on OS major version + architecture so baselines are more reusable and less noisy.</p>
</li>
</ul>
<p>Why per-runner baselines?</p>
<p>Micro-benchmarks are sensitive to hardware, CPU topology, OS version, and underlying virtualization. Comparing numbers across different runner families (for example, local dev Mac vs GitHub-hosted Ubuntu EPYC) leads to false regressions. Using per-runner baselines reduces noise and increases signal when evaluating perf regressions.</p>
<p>Workflow behavior (how baselines are promoted)</p>
<ul>
<li>The Benchmarks GitHub Action runs on a runner and computes a family string for that runner.</li>
<li>The compare step attempts to use a per-family baseline file (guard_validation_baseline.<family>.json). If that file exists it will be used.</li>
<li>If the per-family baseline does not exist, the workflow falls back to the generic baseline (guard_validation_baseline.json) if present.</li>
<li>To propose a new baseline for the current runner family, run the Benchmarks workflow with the workflow_dispatch input <code>updateBaseline=true</code>.</li>
<li>The job will generate guard_validation_current_baseline.<family>.json and open an automated PR that replaces/creates test/perf/baselines/guard_validation_baseline.<family>.json with the current results.</li>
<li>A human reviewer should inspect the PR (and the baseline metadata) before merging.</li>
</ul>
<p>Policy for running strict perf assertions</p>
<ul>
<li>Strict perf assertions (the <code>perf-assertions</code> project) require a family-specific baseline in order to run on GitHub-hosted runners. The policy is conservative because hosted runners may change over time and we prefer to avoid flaky CI failures.</li>
<li>If a family baseline exists, perf assertions run normally.</li>
<li>If no family baseline exists:</li>
<li>If updateBaseline=true, the workflow writes the current baseline and opens a PR for promotion.</li>
<li>Otherwise, the workflow will skip running the strict perf assertions on hosted runners (to avoid noisy failures). The workflow will still generate artifacts and a compare summary.</li>
<li>Self-hosted runners (or controlled perf runners) are allowed to run strict perf assertions even if no family baseline exists. If you want to run assertions on a self-hosted runner with no baseline, create or adjust the appropriate family baseline or set the <code>updateBaseline</code> flag to produce a candidate baseline PR.</li>
</ul>
<p>Inspecting and reviewing baseline PRs</p>
<ul>
<li>Baseline PRs contain the new baseline JSON file and the metadata (OS, CPU, dotnet version, commit) that produced the baseline. Reviewers should ensure the environment is the intended one (for example, an authorized perf runner) and that the numbers look reasonable before merging.</li>
</ul>
<p>Notes</p>
<ul>
<li>If you want to adopt a stricter or looser policy (for example, auto-merge baselines created on a protected runner or require multiple runs before promoting), ask and we can update the workflow to implement that policy (for example, add protected-branch rules, a reviewer requirement, or a second-run verification).</li>
</ul>
<p>Interim note: CI enforcement of the macrobench "no measurable regression" gate is deferred; run the macrobench locally before pushing and include results in your PR description.</p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../../misc/vscode-devkit-tests/" class="btn btn-neutral float-left" title="VS Code Dev Kit: Running xUnit Tests"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../../../Development/release-process/" class="btn btn-neutral float-right" title="Fifth Language Release Process">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../../misc/vscode-devkit-tests/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../../../Development/release-process/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../../..";</script>
    <script src="../../../js/theme_extra.js"></script>
    <script src="../../../js/theme.js"></script>
      <script src="../../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
